#   Refer for explanation to following link:
#   https://lefthook.dev/configuration/

pre-commit:
  parallel: false
  piped: true
  jobs:
    - name: lint
      run: pnpm exec oxlint --fix {staged_files}
    - name: prettier
      run:
        sh -c 'files=$(git diff --cached --name-only --diff-filter=ACMRT | while IFS= read -r f; do
        [ -L "$f" ] && continue; printf "%s\n" "$f"; done); [ -z "$files" ] && exit 0; pnpm exec
        prettier --ignore-unknown --check $files; code=$?; pnpm exec prettier --ignore-unknown
        --write $files; exit $code'
    - name: "changeset status: validate frontmatter"
      run: pnpm exec changeset status
      glob: ".changeset/**"
    - name: "og images: check blog posts have images"
      run: pnpm exec tsx apps/docs/scripts/generate-og-images.tsx --check
      glob: "apps/docs/content/blog/**"
    - name: "turbo: build + test + type-check"
      run:
        pnpm exec turbo run --output-logs new-only --no-daemon --filter='!./example-apps/**'
        --filter='!@fragno-dev/create' build types:check test
      glob: "{*.ts,*.tsx,tsconfig.json}"

commit-msg:
  commands:
    "Check commit message format":
      run: scripts/commit-msg {1}
