---
title: Webhooks
description: Configure and handle Stripe webhook events
---

import { Callout } from "fumadocs-ui/components/callout";

## Overview

The Stripe fragment automatically handles webhook events to keep your local subscription data in
sync with Stripe. When events occur in Stripe (like a successful payment, subscription renewal, or
cancellation), Stripe sends webhook events to your application, and the fragment processes them to
update your database.

### Handled Events

The fragment listens for these subscription-related events:

- **`checkout.session.completed`** - Creates the subscription record after successful checkout
- **`customer.subscription.updated`** - Updates subscription data when changes occur (renewals, plan
  changes, etc.)
- **`customer.subscription.deleted`** - Removes subscriptions
- **`customer.subscription.paused`** - Updates status when subscriptions are paused
- **`customer.subscription.resumed`** - Updates status when subscriptions resume
- **`customer.subscription.trial_will_end`** - Notifies when trials are ending soon (3 days before)

All of these events automatically update your local `subscription` table to match the state in
Stripe.

## When not to rely on webhooks

Webhooks are not guaranteed to be delivered in real-time, therefore there are cases where you may
need to get the latest subscription information from Stripe directly. See
[Manual Synchronization](/docs/our-fragments/stripe/subscriptions#manual-synchronization) for
additional details.

## Webhook Endpoint URL

The webhook endpoint is available under the `{mountPath}/webhook` path, for example:

```
https://yourdomain.com/api/stripe/webhook
```

Here `/api/stripe` is the default mount path where you have mounted the Stripe fragment.

<Callout type="info">
  For local development, you'll need to use the Stripe CLI to forward webhooks. See [Testing
  Webhooks Locally](#testing-webhooks-locally) below.
</Callout>

## Custom Webhook Event Handlers

To implement custom handlers for webhook events supply the fragment with the `onEvent` callback.
This callback is ran _before_ the handlers of the fragment.

```typescript
export const stripeFragment = createStripeFragment({
  // ... other configs
  onEvent: async ({event}) => {
      switch (event.type) {
          case 'checkout.session.completed':
          // do things
          break;
      }
    }
  }
});
```

## Testing Webhooks Locally

Use the [Stripe CLI](https://docs.stripe.com/cli/listen) to forward webhook events to your local
server.

```bash
stripe listen --forward-to localhost:3000/api/stripe/webhook
```

Then use the webhook secret provided by the CLI in your fragment config.
